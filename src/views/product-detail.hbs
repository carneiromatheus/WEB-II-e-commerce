<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>{{product.name}}</title>
</head>
<body>
    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f4f4f4;">
        <div>
            <a href="/" style="text-decoration: none; font-weight: bold;">üè† Home</a>
            
            {{#if user}}
                <a href="/my-orders" style="margin-left: 20px; text-decoration: none;">üì¶ Meus Pedidos</a>
            {{/if}}
        </div>
        
        <a href="/cart" style="text-decoration: none; font-size: 18px;">
            üõí Ver Carrinho
        </a>
    </div>

    <div style="margin-top: 20px;">
        {{#if product.photo_url}}
            <img src="{{product.photo_url}}" alt="{{product.name}}" style="max-width: 300px;">
        {{/if}}

        <h1>{{product.name}}</h1>
        <p>{{product.description}}</p>
        <h2>R$ {{product.price}}</h2>
        <p>Vendido por: {{product.seller_name}}</p>

        <form id="add-to-cart-form" action="/cart/add" method="POST">
            <input type="hidden" name="productId" value="{{product.id}}">
            <input type="hidden" name="productName" value="{{product.name}}">
            <input type="hidden" name="productPrice" value="{{product.price}}">
            
            <label for="quantity">Quantidade:</label>
            <input type="number" id="quantity" name="quantity" value="1" min="1" required>

            <button type="submit">Adicionar ao Carrinho</button>
        </form>

        <div id="message" style="margin-top: 10px; color: green; font-weight: bold;"></div>
    </div>

    <script>
        const form = document.getElementById('add-to-cart-form');
        const messageDiv = document.getElementById('message');

        form.addEventListener('submit', async (e) => {
            e.preventDefault(); // 1. Impede o recarregamento da p√°gina

            // 2. Coleta os dados do formul√°rio
            const formData = new FormData(form);
            const data = Object.fromEntries(formData);

            try {
                // 3. Envia para o servidor via Fetch (AJAX)
                const response = await fetch('/cart/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest' // Importante para o backend saber que √© AJAX
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                // 4. Mostra mensagem de sucesso sem sair da p√°gina
                messageDiv.innerHTML = 
    Sucesso! Agora voc√™ tem ${result.totalItems} itens. 
    <a href="/cart">Finalizar Compra</a>
;
                
            } catch (error) {
                console.error('Erro no AJAX, enviando normal...', error);
                form.submit(); // Fallback: se der erro no JS, envia do jeito cl√°ssico
            }
        });
    </script>
</body>
</html>
